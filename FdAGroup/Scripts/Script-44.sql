

WITH 
C AS (
SELECT A§ARTI, 
INT(A§NUM1) PZXUMV, 
INT(A§NUM3) PESPEZ,  
(A§NUM1*A§NUM3)/1000 PESNET, 
(SELECT SUBSTR(TTLIBE, 7, 3) FROM SMEDATBND.TABELX1L WHERE TTSETT='XCF' AND TRIM(A§ARTI)||'.'||TRIM(A§NOMC)=TTELEM) CNFCRT
FROM SMEDATBND.BRARTI0F WHERE A§CLCO='P_FIN' 
), Y13 AS (
SELECT MONTH(S§DTRE) "M13",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2013"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2013 
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
), Y14 AS (
SELECT MONTH(S§DTRE) "M14",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2014"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2014
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
), Y15 AS (
SELECT MONTH(S§DTRE) "M15",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2015"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2015
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
), Y16 AS (
SELECT MONTH(S§DTRE) "M16",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2016"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2016
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y17 AS (
SELECT MONTH(S§DTRE) "M17",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2017"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2017
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y18 AS (
SELECT MONTH(S§DTRE) "M18",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2018"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2018
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y19 AS (
SELECT MONTH(S§DTRE) "M19",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2019"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2019
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y20 AS ( 
SELECT MONTH(S§DTRE) "M20",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2020"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2020 
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y21 AS ( 
SELECT MONTH(S§DTRE) "M21",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2021"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2021 
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),
Y22 AS ( 
SELECT MONTH(S§DTRE) "M22",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2022"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2022 
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
),Y23 AS ( 
SELECT MONTH(S§DTRE) "M23",
DEC(SUM((S§QTUM*C.PESNET)/100), 10, 3) "2023"
FROM SMEDATBND.GMMOVI0F JOIN C ON S§ARTI=C.A§ARTI 
WHERE S§CDMG='F1' 
--AND S§CAMO='1008' 
AND YEAR(S§DTRE)=2023 
GROUP BY MONTH(S§DTRE) 
ORDER BY 1
)
SELECT 
case 
   wChen digits(M13) = '0000000001' then 'Gennaio'  
   when digits(M13) = '0000000002' then 'Febbraio'  
   when digits(M13) = '0000000003' then 'Marzo'  
   when digits(M13) = '0000000004' then 'Aprile'  
   when digits(M13) = '0000000005' then 'Maggio'  
   when digits(M13) = '0000000006' then 'Giugno'  
   when digits(M13) = '0000000007' then 'Luglio'   
   when digits(M13) = '0000000008' then 'Agosto'  
   when digits(M13) = '0000000009' then 'Settembre'  
   when digits(M13) = '0000000010' then 'Ottobre'  
   when digits(M13) = '0000000011' then 'Novembre'  
   else 'Dicembre'  end "Mese", 
     "2013", "2014", "2015","2016","2017",COALESCE("2018", 0)  "2018", COALESCE("2019", 0) "2019",COALESCE("2020", 0) "2020", COALESCE("2021", 0) "2021", COALESCE("2022", 0) "2022", COALESCE("2023", 0) "2023"
   FROM 
Y13 LEFT JOIN Y14 ON M13 = M14 
LEFT JOIN Y15 ON  M13 = M15
LEFT JOIN Y16 ON  M13 = M16
LEFT JOIN Y17 ON  M13 = M17
LEFT JOIN Y18 ON  M13 = M18
LEFT JOIN Y19 ON  M13 = M19
LEFT JOIN Y20 ON  M13 = M20
LEFT JOIN Y21 ON  M13 = M21
LEFT JOIN Y22 ON  M13 = M22
LEFT JOIN Y23 ON  M13 = M23