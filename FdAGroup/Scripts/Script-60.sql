SELECT
T5AZIE || '|' ||  -- GL_BUSINESS_UNIT_CODE, 
R5CONT || '|' ||  -- GL_ACCOUNT_NUMBER, 
R5PROG || '|' ||  -- GL_JOURNAL_ID,
R5DTIN || '|' ||  -- GL_ENTRY_DATE , 
R5ORIN || '|' ||  -- GL_ENTRY_TIME,
T5DREG || '|' ||  -- GL_EFFECTIVE_DATE,
R5ESER || '|' ||  -- GL_FISCAL_YEAR,
(CASE WHEN (T5FL20<>'' OR R5FL18<>'') THEN '1' ELSE ' ' END) || '|' ||  -- GL_MANUAL_INDICATOR,
R5DAAV || '|' ||  -- GL_AMOUNT_CR_DR_INDICATOR,
(CASE WHEN R5VALU='' THEN 'EUR' ELSE R5VALU END) || '|' ||  -- GL_REPORTING_AMOUNT_CURRENCY,
R5IMPO || '|' ||  -- GL_REPORTING_AMOUNT,
TTDESC || '|' ||  -- GL_DESCRIPTION,
T5DDOR || '|' ||  -- GL_DOCUMENT_DATE,
T5USIN            -- GL_USER_REGISTRATION
FROM SMEDATFDA.C5TREG0F INNER JOIN SMEDATFDA.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- FDA
--FROM SMEDATLIZ.C5TREG0F INNER JOIN SMEDATLIZ.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- LIZZI  
--FROM SMEDATBND.C5TREG0F INNER JOIN SMEDATBND.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- SIPA                
ON TTSETT='C5B' AND TTELEM=R5CONT WHERE T5AZIE IN 
-- ('03', '04', '05', '08') 
('01', '02', '06', '07', '11') -- FDA
--('09')  -- LIZZI                   
--('10', '12')  -- SIPA
--AND T5DREG BETWEEN 20240101 AND 20241031   -- primo  bim.  
AND T5DREG BETWEEN 20240101 AND 20240331   -- primo   trim 
--AND T5DREG BETWEEN 20240401 AND 20240630   -- secondo trim
--AND T5DREG BETWEEN 20240701 AND 20240930   -- terzo   trim
--AND T5DREG BETWEEN 20241001 AND 20241231   -- quarto trim
--AND T5DREG BETWEEN 20240101 AND 20241231   -- Anno intero
AND T5FL01<='2' AND T5FL02='6' AND R5FL19='1'                                  
AND T5TPRO<>'**' AND (R5IMPO<>0 OR R5IMVA<>0) 


-- CHECK DATI 
SELECT SUM(R5IMPO) AS "SOMMA" 
--FROM SMEDATFDA.C5TREG0F INNER JOIN SMEDATFDA.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- FDA
FROM SMEDATLIZ.C5TREG0F INNER JOIN SMEDATLIZ.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- LIZZI  
--FROM SMEDATBND.C5TREG0F INNER JOIN SMEDATBND.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- SIPA   
ON R5PROG=T5PROG
WHERE  R5DAAV='A'                               
--AND T5DREG BETWEEN 20240101 AND 20241031   -- primo  bim.  
AND T5DREG BETWEEN 20240101 AND 20240331   -- primo   trim 
--AND T5DREG BETWEEN 20240401 AND 20240630   -- secondo trim
--AND T5DREG BETWEEN 20240701 AND 20240930   -- terzo   trim
--AND T5DREG BETWEEN 20241001 AND 20241231   -- quarto trim
--AND T5DREG BETWEEN 20240101 AND 20241231   -- Anno intero
UNION 
SELECT SUM(R5IMPO)*-1 AS "SOMMA" 
--FROM SMEDATFDA.C5TREG0F INNER JOIN SMEDATFDA.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- FDA
FROM SMEDATLIZ.C5TREG0F INNER JOIN SMEDATLIZ.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- LIZZI  
--FROM SMEDATBND.C5TREG0F INNER JOIN SMEDATBND.C5RREG0F ON R5PROG=T5PROG INNER JOIN SMEDATGRU5.TABELG0F  -- SIPA 
ON R5PROG=T5PROG 
WHERE  R5DAAV='D'                                
--AND T5DREG BETWEEN 20240101 AND 20241031   -- primo  bim.  
AND T5DREG BETWEEN 20240101 AND 20240331   -- primo   trim 
--AND T5DREG BETWEEN 20240401 AND 20240630   -- secondo trim
--AND T5DREG BETWEEN 20240701 AND 20240930   -- terzo   trim
--AND T5DREG BETWEEN 20241001 AND 20241231   -- quarto trim
--AND T5DREG BETWEEN 20240101 AND 20241231   -- Anno intero


